<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tugas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@heroicons/react/solid"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.3/ionicons.min.js"></script>
    <!-- Import SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="h-screen flex flex-col bg-cover bg-center pt-[60px]" style="background-image: url('/images/bg_moka.png');">
    
    <!-- Navbar -->
    <%- include('../layout/navKepala') %>

    
    <!-- Kontainer Utama -->
    <div class="flex-grow flex-justify-center items-start mt-[80px] ml-[20px]">
        <div class="bg-white bg-opacity-90 rounded-[10px] p-8 shadow-lg w-[1400px]">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-[#C15E15]">Tugas</h2>
                <a href="/kepala/formAddTugas" class="px-4 py-2 bg-[#C15E15] text-white rounded-md hover:bg-[#A14B10]">Tambah Tugas</a>
            </div>
            
            <!-- Tabel -->
            <div class="overflow-auto w-full">
                <table class="w-full border-collapse border border-gray-300 text-center">
                    <thead>
                        <tr class="bg-[#C15E15] text-white">
                            <th class="p-3 border">No</th>
                            <th class="p-3 border">Nama Tugas</th>
                            <th class="p-3 border">Created At</th>
                            <th class="p-3 border">Deadline</th>
                            <th class="p-3 border">Nama Staff</th>
                            <th class="p-3 border">Status</th>
                            <th class="p-3 border">Read At</th>
                            <th class="p-3 border">Progres</th>
                            <th class="p-3 border">Keterangan</th>
                            <th class="p-3 border">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="taskTableBody" class="text-gray-700">
                        <script>
                            const taskTableBody = document.getElementById('taskTableBody');

                            // Contoh data tugas dengan 1 dan lebih dari 1 staff
                            const tasks = [
                                {
                                    id: 1,
                                    no: 1,
                                    namaTugas: "Tugas 1",
                                    createdAt: { time: "08:30", date: "2024-02-01" },
                                    deadline: { time: "17:00", date: "2024-02-10" },
                                    namaStaff: ["Staff A", "Staff B"], 
                                    status: ["Sudah Dibaca", "Belum Dibaca"],
                                    readAt: [{ time: "10:00", date: "2024-02-02" }, { time: "-", date: "-" }],
                                    progres: ["50%", "20%"],
                                    keterangan: ["Diberikan", "Revisi"]
                                },
                                {
                                    id: 2,
                                    no: 2,
                                    namaTugas: "Tugas 2",
                                    createdAt: { time: "09:00", date: "2024-02-03" },
                                    deadline: { time: "15:00", date: "2024-02-12" },
                                    namaStaff: ["Staff C"], 
                                    status: ["Sudah Dibaca"],
                                    readAt: [{ time: "11:00", date: "2024-02-04" }],
                                    progres: ["80%"],
                                    keterangan: ["Diberikan"]
                                }
                            ];

                            tasks.forEach((task) => {
                                task.namaStaff.forEach((staff, index) => {
                                    taskTableBody.innerHTML += `
                                        <tr class="border">
                                            ${index === 0 ? `<td class="p-3 border" rowspan="${task.namaStaff.length}">${task.no}</td>` : ""}
                                            ${index === 0 ? `<td class="p-3 border" rowspan="${task.namaStaff.length}">${task.namaTugas}</td>` : ""}
                                            ${index === 0 ? `
                                                <td class="p-3 border" rowspan="${task.namaStaff.length}">
                                                    <div>${task.createdAt.time}</div>
                                                    <div class="text-sm">${task.createdAt.date}</div>
                                                </td>
                                                <td class="p-3 border" rowspan="${task.namaStaff.length}">
                                                    <div>${task.deadline.time}</div>
                                                    <div class="text-sm">${task.deadline.date}</div>
                                                </td>
                                            ` : ""}
                                            <td class="p-3 border">${staff}</td>
                                            <td class="p-3 border">
                                                <span class="px-3 py-1 rounded-md text-white ${task.status[index] === "Sudah Dibaca" ? 'bg-green-500' : 'bg-red-500'}">
                                                    ${task.status[index]}
                                                </span>
                                            </td>
                                            <td class="p-3 border">
                                                <div>${task.readAt[index].time}</div>
                                                <div class="text-sm">${task.readAt[index].date}</div>
                                            </td>
                                            <td class="p-3 border">
                                                <div class="flex items-center justify-between bg-[#D9D9D9] rounded-full px-3 py-2">
                                                    <span>${task.progres[index]}</span>
                                                    <a href="../admin/formProgres/${task.id}" class="bg-blue-500 p-2 rounded-full hover:bg-blue-700 flex items-center justify-center">
                                                        <ion-icon name="information-circle-outline" class="text-white text-xl"></ion-icon>
                                                    </a>
                                                </div>
                                            </td>
                                            <td class="p-3 border">
                                                <span class="px-3 py-1 rounded-md text-white ${task.keterangan[index] === "Diberikan" ? 'bg-blue-500' : 'bg-red-500'}">
                                                    ${task.keterangan[index]}
                                                </span>
                                            </td>
                                            <td class="p-3  flex justify-center space-x-2">
                                                <a href="../admin/formEditTask/${task.id}" class="bg-green-500 p-2 rounded-full hover:bg-green-700 flex items-center justify-center">
                                                    <ion-icon name="pencil-outline" class="text-white text-lg"></ion-icon>
                                                </a>
                                                <button onclick="openDeleteModal(${task.id})" class="bg-red-500 p-2 rounded-full hover:bg-red-700 flex items-center justify-center">
                                                    <ion-icon name="trash-outline" class="text-white text-lg"></ion-icon>
                                                </button>
                                            </td>
                                        </tr>
                                    `;
                                });
                            });

                            function openDeleteModal(taskId) {
                                Swal.fire({
                                    title: "Konfirmasi Hapus",
                                    text: "Apakah Anda yakin ingin menghapus tugas ini?",
                                    icon: "warning",
                                    showCancelButton: true,
                                    confirmButtonColor: "#d33",
                                    cancelButtonColor: "#808080",
                                    confirmButtonText: "Ya, Hapus",
                                    cancelButtonText: "Batal",
                                    heightAuto: false
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        window.location.href = "/admin/deleteTask/" + taskId;
                                    }
                                });
                            }
                        </script>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
     <!-- Footer -->
     <%- include('../layout/footer') %>
</body>
</html>
