<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daftar Tugas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.3/ionicons.min.js"></script>
    <!-- Import SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="h-screen flex flex-col bg-cover bg-center pt-[60px]" style="background-image: url('/images/bg_moka.png');">
    
    <!-- Navbar -->
    <%- include('../layout/navStaf') %>

    <!-- Kontainer Utama -->
    <div class="flex-grow justify-center items-start mt-[80px] ml-[20px]">
        <div class="bg-white bg-opacity-90 rounded-[10px] p-8 shadow-lg w-[1400px]">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-[#C15E15]">Penugasan</h2>
            </div>
            
            <!-- Tabel -->
            <div class="overflow-auto w-full">
                <table class="w-full border-collapse border border-gray-300 overflow-visible">
                    <thead>
                        <tr class="bg-[#C15E15] text-white text-center">
                            <th class="p-3 border w-[10px]">No</th>
                            <th class="p-3 border w-[80px]">Nama Tugas</th>
                            <th class="p-3 border w-[40px]">Deskripsi Tugas</th>
                            <th class="p-3 border w-[30px]">Penugas</th>
                            <th class="p-3 border w-[80px]">Deadline</th>
                            <th class="p-3 border w-[80px]">Created at</th>
                            <th class="p-3 border w-[50px]">Status</th> <!-- Memperluas kolom -->
                            <th class="p-3 border w-[80px]">Rincian Tugas</th>
                            <th class="p-3 border w-[20px]">Keterangan</th>
                            <th class="p-3 border w-[20px]">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="taskTableBody" class="text-gray-700"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const taskTableBody = document.getElementById('taskTableBody');

        // Contoh data tugas
        const tasks = [
            {
                id: 1,
                no: 1,
                namaTugas: "Laporan Keuangan Q1",
                deskripsiTugas: "Membuat laporan keuangan triwulan pertama",
                penugas: "Kepala Bappeda",
                deadline: { time: "17:00", date: "2024-03-10" },
                createdAt: { time: "08:30", date: "2024-02-01" },
                rincianTugas: [
                    { rincian: "Pengumpulan data", keterangan: "Diberikan" },
                    { rincian: "Analisis keuangan", keterangan: "Revisi" },
                    { rincian: "Penyusunan laporan", keterangan: "Selesai" }
                ],
                status: "Belum Dibaca"
            },
            {
                id: 2,
                no: 2,
                namaTugas: "Evaluasi Proyek Infrastruktur",
                deskripsiTugas: "Menganalisis dampak proyek infrastruktur",
                penugas: "Kepala Bappeda",
                deadline: { time: "15:00", date: "2024-04-05" },
                createdAt: { time: "10:00", date: "2024-03-01" },
                rincianTugas: [
                    { rincian: "Survey lokasi", keterangan: "Selesai" },
                    { rincian: "Wawancara masyarakat", keterangan: "Selesai" },
                    { rincian: "Analisis data", keterangan: "Selesai" }
                ],
                status: "Sudah Dibaca"
            }
        ];

        // Loop untuk memasukkan data ke dalam tabel
        tasks.forEach((task, index) => {
            task.rincianTugas.forEach((rincian, rincianIndex) => {
                const row = document.createElement("tr");
                row.classList.add("border");

                row.innerHTML = `
                    ${rincianIndex === 0 ? `<td class="p-3 border text-left" rowspan="${task.rincianTugas.length}">${task.no}</td>` : ""}
                    ${rincianIndex === 0 ? `<td class="p-3 border text-left" rowspan="${task.rincianTugas.length}">${task.namaTugas}</td>` : ""}
                    ${rincianIndex === 0 ? `<td class="p-3 border text-left" rowspan="${task.rincianTugas.length}">${task.deskripsiTugas}</td>` : ""}
                    ${rincianIndex === 0 ? `<td class="p-3 border text-left" rowspan="${task.rincianTugas.length}">${task.penugas}</td>` : ""}
                    ${rincianIndex === 0 ? `
                        <td class="p-3 border text-left" rowspan="${task.rincianTugas.length}">
                            <div>${task.deadline.time}</div>
                            <div class="text-sm">${task.deadline.date}</div>
                        </td>
                        <td class="p-3 border text-left" rowspan="${task.rincianTugas.length}">
                            <div>${task.createdAt.time}</div>
                            <div class="text-sm">${task.createdAt.date}</div>
                        </td>
                    ` : ""}
                    ${rincianIndex === 0 ? `
                        <td class="p-3 border text-left w-40" rowspan="${task.rincianTugas.length}">
                            <select class="p-2 rounded-md border border-gray-300 w-full text-white font-semibold" 
                                style="background-color: ${task.status === 'Belum Dibaca' ? '#ef4444' : '#10b981'}"
                                onchange="updateStatus(this, ${index})">
                                <option value="Belum Dibaca" class="text-red-500" ${task.status === "Belum Dibaca" ? "selected" : ""}>Belum Dibaca</option>
                                <option value="Sudah Dibaca" class="text-green-500" ${task.status === "Sudah Dibaca" ? "selected" : ""}>Sudah Dibaca</option>
                            </select>
                        </td>
                    ` : ""}
                    <td class="p-3 border text-left">${rincian.rincian}</td>
                    <td class="p-3 border text-${rincian.keterangan === "Diberikan" ? "blue-500" : rincian.keterangan === "Revisi" ? "red-500" : "green-500"}">${rincian.keterangan}</td>
                    ${rincianIndex === 0 ? `
                        <td class="p-3 border text-left" rowspan="${task.rincianTugas.length}">
                            <button id="updateButton${task.id}" onclick="updateTask(${task.id})"
                                class="bg-yellow-500 text-white px-4 py-2 rounded-md hover:bg-yellow-600 ${task.rincianTugas.every(rt => rt.keterangan === 'Selesai') ? 'opacity-50 cursor-not-allowed' : ''}"
                                ${task.rincianTugas.every(rt => rt.keterangan === 'Selesai') ? 'disabled' : ''}>
                                Update
                            </button>
                        </td>
                    ` : ""}
                `;

                taskTableBody.appendChild(row);
            });
        });

        function updateStatus(selectElement, index) {
            tasks[index].status = selectElement.value;
            selectElement.style.backgroundColor = selectElement.value === "Belum Dibaca" ? "#ef4444" : "#10b981";
            
            // **Menampilkan modal sukses setelah status diperbarui**
            Swal.fire({
                icon: "success",
                title: "Status Diperbarui",
                text: `Status tugas telah diperbarui menjadi: ${tasks[index].status}`,
                confirmButtonText: "OK",
                confirmButtonColor: "#C15E15",
            });
        }
    </script>

    <!-- Footer -->
    <%- include('../layout/footer') %>
</body>
</html>
